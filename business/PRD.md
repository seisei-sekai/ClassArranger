
## 工作流程分析

### 业务完整工作流程图

```
学管填写阶段
├─ 1. 填写学生基本信息（校区、学管、学生姓名、批次）
├─ 2. 填写课程信息（频次、时长、形式、内容）
├─ 3. 填写时间要求（起止时间、希望时间段）
├─ 4. 填写补充信息（备注、特殊要求）
└─ 5. 提交到教务处理

教务处理阶段
├─ 步骤1: 学生课时确认（列22）
│   └─ 检查学生是否有足够课时
│
├─ 步骤2: 讲师时间确认（列23）
│   └─ 联系老师，确认时间可用性
│
├─ 步骤3: 教室确定（列24）
│   └─ 根据校区和时间安排教室
│
├─ 步骤4: 课表制作（列25）
│   └─ 制作详细的课程表
│
├─ 步骤5: 讲师时间再次确认（列26）
│   └─ 课表制作后再次与老师确认
│
├─ 步骤6: 学生时间确认（列27）
│   └─ 与学生确认最终时间
│
├─ 步骤7: 钉钉登录大屏幕（列28）
│   └─ 将课表信息录入钉钉系统
│
├─ 步骤8: 课表发放讲师端（列29）
│   └─ 将课表发送给授课老师
│
├─ 步骤9: 课表发放学生端（列30）
│   └─ 将课表发送给学生
│
└─ 步骤10: 最终确认（列31）
    └─ 教务处最终确认完成

学管确认阶段
└─ 学管确定（列32）
    └─ 学管对课程安排进行最终确认
```

### 课程匹配系统工作流程图（主要在XdfClassArranger/Function文件夹里）

这个系统其实是这样的：
（1）这个系统总的来说是像消消乐一样，首先有个中间的日历，其实是一个超长的一维数组，不过在周视角变成每24个小时到一个新的一列。周视角里最小的单元是5分钟，一列有一天24小时，所以总共display的单元有7*24*5格。

这里是用来放填充放不同学生需要被上的课的地方，步骤是：
- 先从studentparser获得所有的学生的需要被上的课可能时间（因为例如学生一周只能在周三周五下午1-6点xx校区上课，但是他一周只需要上两个分开的课时（假设每个一小时），所以要列举出他的所有的可能时间）

- 现在整个课表上有所有学生的可能上课时间后（with 课程需要的特殊条件，例如日语课，数学课等），现在需要的是让teacher在合适的classroom里给学生找到时间上课。

- 每个老师能教的课和可以教的时间段以及一些其他约束都是不一样的，现在作为排课系统的首要条件，就是给这些学生排课，使得在局限的教师资源和教室资源下，每个学生都能按照他自己特殊的约束被排好课。（有些学生还会要求特定姓名的老师给他们上课）

- 排课系统的存在目的，就是自动把非格式化的紫烟语言的excel表格的数据换成格式化的能放在时间表里被匹配系统解决的约束，然后让排课系统对教师资源和教室资源进行调度来试图解决这个问题。

-这个排课系统因为是非技术人员管理员进行操作，所以对他的UX和UI的可读性也非常重要。所以我设计了一个视觉系统来帮助该管理员进行操作：

名称：课程需求待解决视觉系统：
（1）该系统使用颜色的深度作为提示，假设有256个档，0是白色，256是最深的那个颜色，中间的数字是interpolation。
（2）颜色的深浅由多少个同学的可用时间在该时间block上重叠后normalize决定。例如整个周总视角只有同学A 在周三到周五时间段X有课的待被解决的课，那么这个X的时间段的深度就是256。因为这个周榜上没有被重叠的课。但如果同学B的课的availability 时间段Y，整整cover了同学A的时间段X，同时周六时间段Y也cover，那么X和Y的交集颜色就会比 Y单独有的时间点要深颜色。如果同学C的时间段Z和X一摸一样，假设同学B的时间段Y不在，那么颜色依旧是X（同时也是Z）那一段最深（这个是特例），但是如果XYZ都同时在的话，Y跟XZ之间的色差比例会变大。

- 请设计一个通用课扩展上课条件的格式化interface，使得可以让管理员自行添加条件，自行生成匹配。要基于现在的前端情况的。




### 课程匹配系统工作流程简述（核心逻辑位于 XdfClassArranger/Function 文件夹）

本系统的运行机制如下：

1. 系统以中间日历为核心，结构上类似一维数组，切换为周视图时，每24小时为一列，每5分钟为最小时间单元。完整一周在界面上显示为 `7×24×12`（即7天，每天24小时，每小时12个5分钟block）个格子。

2. 每位学生的所有可排课时间由 `studentParser` 负责解析。例如，若某学生仅可在每周三、周五下午1-6点于XX校区上课，且每周仅需安排两节一小时课程，系统需将其所有可能上课时间段列举出来。

3. 汇总所有学生的可上课时间后（并考虑课程的特殊要求，例如科目、上课地点），进入教师排课阶段。排课的目标是在有限的教师和教室资源下，满足每位学生的个性化需求（比如特定老师、时间限制等），为其精准分配课程时间。此阶段需遵循教师可教科目、可用时间段及各类约束条件。

4. 系统的核心作用是：自动将非结构化的 Excel 原始数据转化为结构化的时间表所需的约束参数，进而驱动排课引擎智能调度教师和教室资源，完成最优解算。

5. 为便于非技术管理员操作，系统特别设计了“课程需求可视化系统”，通过色阶直观展示课程待解决情况。具体逻辑如下：
   - 色深分256级，0为白色，256为最深色，中间色值通过插值（interpolation）生成。
   - 同一时段内，重叠的学生可用时间越多，该时间块的色阶越深。举例：若本周仅学生A可在周三-周五X时段上课，则X块色值为最深（256）；如学生B的可用时段Y完全覆盖A的X，且还有其他时段，则X与Y的交集区域色值更深，Y单独区域较浅。如果A和C的可用时段完全重叠而B不重叠，则X/Z块色阶依旧最深。当ABC三人时段均有交集，则交集处色差进一步拉大。

6. 接口开放性设计：请基于当前前端架构，设计一套通用、可扩展的上课条件参数化接口（interface），支持管理员自定义和添加新的排课约束，实现灵活高效的课程匹配功能。



