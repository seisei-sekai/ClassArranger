# 学生可用性显示控制功能

## 功能概述

为解决当学生数量较多（如44个）时，一次性显示所有学生可用性导致日历混乱的问题，现增加了**独立控制每个学生可用性显示**的功能。

---

## 核心功能

### 1. 单个学生可用性控制

**位置**: 每个学生卡片的左侧

**功能**: 
- 点击眼睛图标可以切换该学生的可用性显示
- 👁️ 实心眼睛 = 该学生可用性**正在显示**
- 👁️‍🗨️ 斜线眼睛 = 该学生可用性**已隐藏**

**使用场景**:
- 只关注特定几个学生的可用时间
- 对比不同学生的时间冲突
- 逐个分析每个学生的排课可能性

### 2. 全选/取消全选控制

**位置**: 学生面板顶部按钮区

**功能**:
- 快速切换所有学生的可用性显示
- 智能判断：如果有任何学生未显示，则全部显示；否则全部隐藏
- 图标会根据当前状态变化（全选时显示勾选的方块，未全选时显示空方块）

**使用场景**:
- 快速查看所有学生的整体可用性
- 快速清空所有显示，重新选择

---

## 使用流程

### 情景1: 查看特定学生的可用时间

1. **确保"可用时间"功能已开启**
   - 点击"可用时间"按钮使其激活（绿色）

2. **选择要查看的学生**
   - 点击学生卡片左侧的眼睛图标
   - 眼睛变为实心 = 该学生可用性将显示在日历上

3. **查看日历**
   - 日历上会用颜色显示所选学生的可用性
   - 颜色深浅代表可用学生的数量比例

4. **添加更多学生对比**
   - 继续点击其他学生的眼睛图标
   - 日历会自动更新，显示多个学生的重叠可用性

### 情景2: 快速查看所有学生

1. **点击"全选显示"按钮**
   - 所有有数据的学生可用性立即显示

2. **查看整体热力图**
   - 红色区域 = 绝大多数学生可用
   - 蓝色区域 = 很少学生可用

3. **快速隐藏**
   - 再次点击"全选显示"按钮
   - 所有学生可用性隐藏

### 情景3: 逐个分析学生

1. **确保所有学生都未显示**
   - 点击"全选显示"确保全部隐藏

2. **逐个打开学生**
   - 点击第一个学生的眼睛图标
   - 查看该学生的可用时间
   - 点击日历上的时间块查看详细约束

3. **对比相邻学生**
   - 保持第一个学生显示
   - 点击第二个学生的眼睛图标
   - 观察两个学生的时间重叠情况

4. **继续添加**
   - 根据需要添加更多学生
   - 找到最佳的共同可用时段

---

## 状态说明

### 学生卡片上的眼睛图标状态

| 图标 | 状态 | 说明 |
|------|------|------|
| 👁️ 实心 | **显示中** | 该学生可用性正在日历上显示 |
| 👁️‍🗨️ 斜线 | **已隐藏** | 该学生可用性未在日历上显示 |

### "全选显示"按钮状态

| 图标 | 状态 | 说明 |
|------|------|------|
| ☑️ 实心方块 | **部分/全部选中** | 至少有一个学生正在显示 |
| ☐ 空方块 | **全部未选** | 所有学生都未显示 |
| 🚫 禁用 | **无可用数据** | 没有学生导入数据 |

---

## 颜色系统配合

### 单个学生显示
当只显示1-2个学生时：
- 颜色会偏向冷色调（浅葱色、若竹色）
- 因为比例较低（1-2个/总数）

### 多个学生显示
当显示多个学生时：
- 颜色会根据重叠比例渐变
- 10个学生中5个可用 = 黄绿色（若草色）
- 10个学生中8个可用 = 橙色（柑子色）

### 全部学生显示
当显示所有44个学生时：
- 能看到完整的热力图
- 红色区域 = 最佳排课时段
- 蓝色区域 = 避开时段

---

## 技术实现

### 数据结构

每个学生对象新增字段：

```javascript
{
  id: 'student-xxx',
  name: '张三',
  color: '#5A6C7D',
  rawData: '...',
  parsedData: null,
  showAvailability: false  // 新增：是否显示可用性
}
```

### 核心函数

#### 1. 切换单个学生
```javascript
const toggleStudentAvailability = (studentId) => {
  setStudents(students.map(s => 
    s.id === studentId 
      ? { ...s, showAvailability: !s.showAvailability } 
      : s
  ));
};
```

#### 2. 全选/取消全选
```javascript
const toggleAllStudentsAvailability = () => {
  const hasDataStudents = students.filter(s => s.rawData);
  const anyHidden = hasDataStudents.some(s => !s.showAvailability);
  
  setStudents(students.map(s => 
    s.rawData 
      ? { ...s, showAvailability: anyHidden } 
      : s
  ));
};
```

#### 3. 过滤显示的学生
```javascript
const refreshAvailabilityEvents = () => {
  if (showAvailability) {
    // 只显示被选中的学生
    const selectedStudents = students.filter(
      s => s.rawData && s.showAvailability
    );
    const events = generateAvailabilityEvents(selectedStudents, calendarRef);
    setAvailabilityEvents(events);
  }
};
```

---

## UI 设计细节

### 眼睛按钮
- **尺寸**: 28x28px
- **位置**: 学生卡片最左侧
- **背景**: 
  - 未激活: `#E8E8E8` (浅灰)
  - 激活: `#6B7C6E` (日系绿)
- **图标**: 
  - 显示中: 实心眼睛
  - 已隐藏: 眼睛+斜线

### 全选按钮
- **文字**: "全选显示"
- **图标**: 4个方块网格
  - 选中时：方块内有勾选标记
  - 未选中时：空方块
- **状态**:
  - 正常: 可点击
  - 禁用: 无学生数据时灰显

---

## 性能优化

### 1. 按需计算
- 只计算被选中学生的可用性
- 避免一次性计算44个学生的数据

### 2. 实时更新
- 使用React的`useEffect`监听学生状态变化
- 自动重新计算可用性事件

### 3. 智能合并
- `generateAvailabilityEvents`函数会合并连续的时间段
- 减少渲染的事件数量

---

## 最佳实践

### 1. 初始排课
- **第一步**: 点击"全选显示"查看整体热力图
- **第二步**: 识别红色（热门）和蓝色（冷门）时段
- **第三步**: 取消全选，逐个分析冲突学生

### 2. 小组排课
- **只显示同一小组的学生**
- 快速找到共同可用时段
- 避免被其他学生干扰视线

### 3. 问题诊断
- **显示时间冲突的学生**
- 对比他们的时间约束
- 找出不可调和的冲突点

### 4. 时间段优化
- **选择特定时间段**（如周一上午）
- 显示该时段有课的学生
- 查看是否可以调整到其他时段

---

## 注意事项

⚠️ **必须先导入数据**: 只有导入了Excel数据的学生才能显示可用性

⚠️ **"可用时间"总开关**: 必须先开启"可用时间"功能，单个学生的toggle才有效

⚠️ **全选逻辑**: "全选显示"只影响**有数据**的学生，没有数据的学生不受影响

⚠️ **颜色混合**: 多个学生显示时，颜色是根据**重叠比例**计算的，不是简单叠加

---

## 对比新旧方案

### 旧方案
```
显示所有44个学生 → 日历一片混乱 → 无法区分
```

### 新方案
```
默认全部隐藏 → 按需选择显示 → 清晰可控
```

### 优势
✅ **灵活控制**: 想看哪个就看哪个  
✅ **对比方便**: 可以只显示2-3个学生对比  
✅ **性能更好**: 只计算需要显示的学生  
✅ **视觉清晰**: 避免44个学生混在一起  

---

## 快捷键（未来可添加）

建议未来可以添加：
- `Ctrl + A`: 全选所有学生
- `Ctrl + D`: 取消全选
- `1-9`: 快速切换前9个学生
- `Space`: 切换当前选中学生卡片的可用性

---

## 总结

通过添加独立的可用性显示控制，成功解决了大量学生时日历混乱的问题。用户现在可以：

✅ **精准控制**: 只显示需要的学生  
✅ **快速切换**: 通过全选按钮一键操作  
✅ **灵活对比**: 选择性显示特定学生组合  
✅ **提升效率**: 避免信息过载，专注关键学生  

这大大提升了排课系统的可用性和用户体验！🎉

