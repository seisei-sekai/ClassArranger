# Function Utils æ¨¡å—è¯´æ˜

æœ¬ç›®å½•åŒ…å«ä» `Function.js` æ‹†åˆ†å‡ºæ¥çš„å·¥å…·å‡½æ•°å’Œå¸¸é‡å®šä¹‰ï¼Œç”¨äºæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚

## æ–‡ä»¶ç»“æ„

### ğŸ“„ constants.js (30 è¡Œ)
**åŠŸèƒ½**: å­˜æ”¾æ‰€æœ‰å¸¸é‡å®šä¹‰

**å¯¼å‡ºå†…å®¹**:
- `EXCEL_COLUMNS`: Excelåˆ—æ ‡é¢˜å­—ç¬¦ä¸²ï¼ˆå‰é€”å¡¾1v1çº¦è¯¾.xlsx - 2512è¡¨ï¼‰
- `JAPANESE_COLORS`: æ—¥ç³»é…è‰²æ•°ç»„
- `STANDARD_START`: æ ‡å‡†å¼€å§‹æ—¶é—´ (9:00)
- `STANDARD_END`: æ ‡å‡†ç»“æŸæ—¶é—´ (21:30)
- `SLOTS_PER_DAY`: æ¯å¤©çš„æ—¶é—´æ§½æ•°é‡ (25ä¸ª)
- `DAY_NAME_TO_NUMBER`: æ˜ŸæœŸåç§°åˆ°æ•°å­—çš„æ˜ å°„
- `getRandomJapaneseColor()`: è·å–éšæœºæ—¥ç³»é¢œè‰²çš„å·¥å…·å‡½æ•°

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
import { JAPANESE_COLORS, STANDARD_START } from './utils/constants';

const color = JAPANESE_COLORS[0]; // '#5A6C7D'
const startHour = STANDARD_START; // 9
```

---

### ğŸ“„ studentParser.js (58 è¡Œ)
**åŠŸèƒ½**: å­¦ç”Ÿæ•°æ®è§£æ

**å¯¼å‡ºå†…å®¹**:
- `parseStudentRows(rawData)`: è§£æä»Excelç²˜è´´çš„å¤šè¡Œå­¦ç”Ÿæ•°æ®

**æ ¸å¿ƒåŠŸèƒ½**:
- å¤„ç†å•å…ƒæ ¼å†…çš„æ¢è¡Œç¬¦ï¼ˆ`\n`ï¼‰
- åˆå¹¶è¢«åˆ†å‰²çš„è¡Œï¼ˆåŸºäºtabæ•°é‡åˆ¤æ–­ï¼‰
- è‡ªåŠ¨æå–å­¦ç”Ÿå§“åï¼ˆç¬¬3åˆ—ï¼‰
- ä¸ºç©ºå§“åç”Ÿæˆé»˜è®¤æ—¶é—´æˆ³åç§°

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
import { parseStudentRows } from './utils/studentParser';

const rawData = 'æ ¡åŒº\tå­¦ç®¡\tå¼ ä¸‰\t...'; // ä»Excelå¤åˆ¶çš„æ•°æ®
const students = parseStudentRows(rawData);
// è¿”å›: [{ rawData, name: 'å¼ ä¸‰', values: [...] }]
```

---

### ğŸ“„ availabilityCalculator.js (266 è¡Œ)
**åŠŸèƒ½**: æ—¶é—´å¯ç”¨æ€§è®¡ç®—å’Œå¯è§†åŒ–

**å¯¼å‡ºå†…å®¹**:
- `parseStudentAvailability(rawData)`: è§£æå•ä¸ªå­¦ç”Ÿçš„æ—¶é—´çº¦æŸï¼Œè¿”å›7x25çš„å¯ç”¨æ€§çŸ©é˜µ
- `calculateOverlappingAvailability(studentsWithData)`: è®¡ç®—æ‰€æœ‰å­¦ç”Ÿçš„é‡å å¯ç”¨æ€§
- `generateAvailabilityEvents(students, calendarRef)`: ç”ŸæˆFullCalendarèƒŒæ™¯äº‹ä»¶
- `getStudentsForTimeSlot(students, dayOfWeek, slotIndex)`: è·å–ç‰¹å®šæ—¶é—´æ§½çš„å¯ç”¨å­¦ç”Ÿåˆ—è¡¨

**æ ¸å¿ƒç®—æ³•**:
1. **æœ€å¤§å®¹å¿åº¦ç­–ç•¥**: é»˜è®¤æ‰€æœ‰æ—¶é—´éƒ½å¯ç”¨ï¼Œé™¤éæ˜ç¡®ç¦æ­¢
2. **æ—¶é—´æ®µè§£æ**: æ”¯æŒ"å‘¨ä¸€åˆ°å‘¨äº”"ã€"ä¸Šåˆ"ã€"ä¸‹åˆ"ã€"æ™šä¸Š"ç­‰è‡ªç„¶è¯­è¨€
3. **æ’é™¤/æŒ‡å®šé€»è¾‘**: è¯†åˆ«"é™¤äº†...ä¹‹å¤–"å’Œ"åªæœ‰...å¯ç”¨"ä¸¤ç§æ¨¡å¼
4. **é‡å è®¡ç®—**: ç»Ÿè®¡æ¯ä¸ªæ—¶é—´æ§½æœ‰å¤šå°‘å­¦ç”Ÿå¯ç”¨
5. **å¯è§†åŒ–ä¼˜åŒ–**: åˆå¹¶è¿ç»­çš„æ—¶é—´æ®µï¼Œå½’ä¸€åŒ–é€æ˜åº¦ï¼ˆ0.1-0.6ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
import { 
  generateAvailabilityEvents, 
  getStudentsForTimeSlot 
} from './utils/availabilityCalculator';

// ç”Ÿæˆå¯ç”¨æ€§èƒŒæ™¯äº‹ä»¶
const events = generateAvailabilityEvents(students, calendarRef);

// è·å–å‘¨ä¸€10:00-10:30çš„å¯ç”¨å­¦ç”Ÿ
const available = getStudentsForTimeSlot(students, 1, 2);
// è¿”å›: [{ name, color, constraints }]
```

---

## ä»£ç ä¼˜åŒ–æˆæœ

### æ‹†åˆ†å‰
- `Function.js`: **1603 è¡Œ** âš ï¸ å¤ªå¤§ï¼Œéš¾ä»¥ç»´æŠ¤

### æ‹†åˆ†å
- `Function.js`: **1282 è¡Œ** âœ… å‡å°‘321è¡Œ (-20%)
- `utils/constants.js`: 30 è¡Œ
- `utils/studentParser.js`: 58 è¡Œ
- `utils/availabilityCalculator.js`: 266 è¡Œ
- **æ€»è®¡**: 1636 è¡Œ

### ä¼˜åŠ¿
1. âœ… **å…³æ³¨ç‚¹åˆ†ç¦»**: æ¯ä¸ªæ–‡ä»¶æœ‰æ˜ç¡®çš„èŒè´£
2. âœ… **å¯æµ‹è¯•æ€§**: å·¥å…·å‡½æ•°å¯ç‹¬ç«‹æµ‹è¯•
3. âœ… **å¯å¤ç”¨æ€§**: å¯åœ¨å…¶ä»–ç»„ä»¶ä¸­å¤ç”¨
4. âœ… **å¯ç»´æŠ¤æ€§**: æ›´å®¹æ˜“å®šä½å’Œä¿®æ”¹ä»£ç 
5. âœ… **å¯è¯»æ€§**: Function.js æ›´ä¸“æ³¨äºç»„ä»¶é€»è¾‘

---

## ä¾èµ–å…³ç³»

```
Function.js
â”œâ”€â”€ utils/constants.js
â”œâ”€â”€ utils/studentParser.js
â””â”€â”€ utils/availabilityCalculator.js
    â””â”€â”€ utils/constants.js
```

**è¯´æ˜**: 
- `Function.js` æ˜¯ä¸»ç»„ä»¶ï¼Œå¯¼å…¥æ‰€æœ‰ utils æ¨¡å—
- `availabilityCalculator.js` ä¾èµ– `constants.js` ä¸­çš„å¸¸é‡
- ä¸‰ä¸ª utils æ–‡ä»¶ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼ˆé™¤äº† constants è¢«å…¶ä»–æ¨¡å—å¯¼å…¥ï¼‰

---

## ç»´æŠ¤æŒ‡å—

### æ·»åŠ æ–°å¸¸é‡
â†’ ä¿®æ”¹ `constants.js`

### ä¿®æ”¹å­¦ç”Ÿæ•°æ®è§£æé€»è¾‘
â†’ ä¿®æ”¹ `studentParser.js`

### ä¿®æ”¹å¯ç”¨æ€§è®¡ç®—ç®—æ³•
â†’ ä¿®æ”¹ `availabilityCalculator.js`

### æ·»åŠ æ–°çš„UIåŠŸèƒ½æˆ–çŠ¶æ€ç®¡ç†
â†’ ä¿®æ”¹ `Function.js`

---

## æ³¨æ„äº‹é¡¹

1. **ä¸è¦åœ¨ utils ä¸­å¯¼å…¥ React**: è¿™äº›æ˜¯çº¯å·¥å…·å‡½æ•°ï¼Œä¿æŒæ— çŠ¶æ€
2. **ä¿æŒå‡½æ•°çº¯ç²¹æ€§**: å°½é‡é¿å…å‰¯ä½œç”¨ï¼Œä¾¿äºæµ‹è¯•
3. **å®Œå–„æ³¨é‡Š**: æ¯ä¸ªå¯¼å‡ºå‡½æ•°éƒ½åº”æœ‰æ¸…æ™°çš„æ³¨é‡Šå’Œç±»å‹è¯´æ˜
4. **ä¿æŒå‘åå…¼å®¹**: ä¿®æ”¹æ—¶æ³¨æ„ä¸è¦ç ´åç°æœ‰çš„è°ƒç”¨æ–¹å¼

---

## æœªæ¥ä¼˜åŒ–æ–¹å‘

1. ğŸ”® æ·»åŠ  TypeScript ç±»å‹å®šä¹‰
2. ğŸ”® ä¸ºå·¥å…·å‡½æ•°ç¼–å†™å•å…ƒæµ‹è¯•
3. ğŸ”® è€ƒè™‘ä½¿ç”¨ Web Worker å¤„ç†å¤§é‡å­¦ç”Ÿæ•°æ®
4. ğŸ”® ä¼˜åŒ–å¯ç”¨æ€§è®¡ç®—ç®—æ³•çš„æ€§èƒ½
5. ğŸ”® æå– FullCalendar ç›¸å…³é€»è¾‘åˆ°ç‹¬ç«‹çš„ hook

