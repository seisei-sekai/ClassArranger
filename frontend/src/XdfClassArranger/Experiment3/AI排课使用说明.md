# [GA] AI自动排课系统 - 使用说明

## [列表] 系统概述

基于遗传算法（Genetic Algorithm）的智能排课引擎，灵感来自 [AlmanacAI](https://github.com/Harjotraith04/Time_Table_Generation_AI_Tool) 项目。

### 核心特性

- [√] **自动冲突检测** - 避免教师、学生、教室时间冲突
- [√] **智能优化** - 使用遗传算法寻找最优排课方案
- [√] **软约束考虑** - 午休时间、合理作息、课程分散度
- [√] **实时进化** - 50代种群进化，实时显示进度
- [√] **可视化结果** - 冲突分析、适应度评分、统计数据

---

## [开始] 快速开始

### 1. 启动应用

```bash
cd sci_tokyo
npm start
```

### 2. 访问排课页面

```
http://localhost:3000/XdfClassArranger_function
```

### 3. 使用AI排课

1. 点击右上角 **"AI自动排课"** 按钮
2. 等待遗传算法进化完成（约3-5秒）
3. 查看排课结果和冲突分析
4. 课程自动显示在日历上

---

## [GA] 遗传算法原理

### 算法流程

```
1. 初始化种群（50个随机课表）
   ↓
2. 评估适应度（冲突检测+优化）
   ↓
3. 选择操作（轮盘赌选择）
   ↓
4. 交叉操作（单点交叉）
   ↓
5. 变异操作（随机改变时间/教室）
   ↓
6. 重复2-5直到达到终止条件
   ↓
7. 返回最优解
```

### 适应度评分

**总分基准**: 100分

**硬约束（严重扣分）**:
- 教师时间冲突: -20分/次
- 学生时间冲突: -20分/次
- 教室冲突: -15分/次

**软约束（轻微扣分）**:
- 午休时间(12:00-13:00)排课: -5分/次
- 连续上课过多: -3分/次
- 早晨课程(<8:00): -2分/次
- 晚间课程(>20:00): -2分/次

**奖励分**:
- 课程分散度良好: +2分

---

## [数据] 配置数据

### 当前配置（示例数据）

#### 教师列表
```javascript
['李老师', '赵老师', '孙老师', '钱老师', '周老师', '吴老师']
```

#### 学生列表
```javascript
['张三', '王五', '李四', '赵六', '孙七', '周八', '吴九', '郑十']
```

#### 教室列表
```javascript
[
  { id: 'r1', name: '个别指导室1', campus: '旗舰校', capacity: 2 },
  { id: 'r2', name: '个别指导室2', campus: '旗舰校', capacity: 2 },
  { id: 'r3', name: '个别指导室3', campus: '旗舰校', capacity: 2 },
  { id: 'r4', name: '板二101', campus: '东京本校', capacity: 4 },
  { id: 'r5', name: '板二102', campus: '东京本校', capacity: 4 },
  { id: 'r6', name: '板二103', campus: '东京本校', capacity: 4 }
]
```

#### 课程列表
```javascript
[
  { id: 'c1', name: '1v1大学面试练习', teacher: '李老师', student: '张三', duration: 2 },
  { id: 'c2', name: '1v1志望理由书指导', teacher: '赵老师', student: '王五', duration: 2 },
  // ... 共8门课程
]
```

#### 时间段
- **工作日**: 周一至周五
- **时间段**: 09:00, 11:00, 14:00, 16:00, 18:00
- **每节课时长**: 2小时

---

## [控制]️ 算法参数

### 默认参数

| 参数 | 值 | 说明 |
|------|----|----|
| `populationSize` | 50 | 种群大小 |
| `mutationRate` | 0.1 | 变异率（10%） |
| `crossoverRate` | 0.7 | 交叉率（70%） |
| `elitismRate` | 0.1 | 精英保留率（10%） |
| `maxGenerations` | 100 | 最大进化代数 |

### 参数说明

**种群大小**
- 越大 → 搜索空间越广，但计算时间越长
- 越小 → 速度快，但可能陷入局部最优

**变异率**
- 越高 → 多样性强，但可能破坏好的解
- 越低 → 稳定性好，但容易早熟收敛

**交叉率**
- 越高 → 探索能力强
- 越低 → 保守策略

**精英保留率**
- 保留每代的最优个体
- 防止最优解丢失

---

## [配置] 自定义配置

### 修改算法参数

编辑 `Function.js` 中的参数：

```javascript
const ga = new GeneticAlgorithm({
  populationSize: 50,      // 修改种群大小
  mutationRate: 0.1,       // 修改变异率
  crossoverRate: 0.7,      // 修改交叉率
  elitismRate: 0.1,        // 修改精英保留率
  maxGenerations: 100,     // 修改最大代数
  ...aiScheduleData
});
```

### 修改课程数据

编辑 `Function.js` 中的 `aiScheduleData`：

```javascript
const aiScheduleData = {
  teachers: ['你的', '教师', '列表'],
  students: ['你的', '学生', '列表'],
  rooms: [
    { id: 'r1', name: '教室名', campus: '校区', capacity: 人数 }
  ],
  courses: [
    { 
      id: 'c1', 
      name: '课程名', 
      teacher: '教师名', 
      student: '学生名', 
      duration: 2,
      color: '#5A6C7D' 
    }
  ],
  timeSlots: [
    { day: '周一', start: '09:00' }
  ]
};
```

---

## [统计] 结果解读

### AI面板显示

#### 进化中
- 显示实时进度条
- 进度百分比
- "遗传算法进化中..."提示

#### 完成后
1. **适应度评分**
   - 0-60分：较差，有较多冲突
   - 60-80分：良好，有少量冲突
   - 80-95分：优秀，几乎无冲突
   - 95-100分：完美，无冲突

2. **统计数据**
   - 进化代数：算法运行的代数
   - 课程数量：成功排入的课程总数

3. **冲突分析**
   - 教师冲突：同一教师在同一时间段的课程数
   - 学生冲突：同一学生在同一时间段的课程数
   - 教室冲突：同一教室在同一时间段的课程数
   - 午休违规：12:00-13:00时间段的课程数

### 颜色标识

- [绿色] **绿色背景** (0冲突)：完美
- [黄色] **黄色背景** (有冲突)：需要注意
- [蓝色] **蓝色背景** (软约束)：建议优化

---

## [目标] 最佳实践

### 1. 数据准备

**课程数量建议**:
- 少于教室容量 × 时间段数 × 0.7
- 例如：6教室 × 25时间段 × 0.7 = 105门课程

**时间段设置**:
- 避免午休时间（12:00-13:00）
- 合理的作息时间（8:00-20:00）
- 每节课间隔足够时间

### 2. 算法调优

**如果适应度低于60分**:
- 减少课程数量
- 增加教室数量
- 增加时间段
- 提高 `populationSize` 到 100
- 增加 `maxGenerations` 到 200

**如果运行时间过长**:
- 减少 `populationSize` 到 30
- 减少 `maxGenerations` 到 50
- 优化课程数据

### 3. 冲突处理

**硬冲突（必须解决）**:
- 教师冲突 → 增加时间段或减少该教师的课程
- 学生冲突 → 同上
- 教室冲突 → 增加教室或调整课程时长

**软冲突（建议优化）**:
- 午休违规 → 手动调整到其他时段
- 连续上课 → 增加时间段间隔
- 早晚课程 → 调整到合理时间

---

## [算法] 高级功能

### 停滞检测

如果20代内适应度没有提升，系统会自动：
- 保留前30%的优秀个体
- 重新生成其余70%的个体
- 防止早熟收敛

### 多样性维护

通过以下机制保持种群多样性：
- 变异操作引入随机性
- 轮盘赌选择避免单一化
- 精英保留保护优秀基因

---

## [提示] 常见问题

### Q: 为什么适应度总是很低？

**A**: 可能原因：
1. 课程数量过多，超出可排容量
2. 某个教师课程过于集中
3. 时间段设置不合理
4. 教室数量不足

**解决方案**：
- 减少课程数量
- 增加教室和时间段
- 检查数据配置

### Q: 如何提高排课质量？

**A**: 建议：
1. 增大 `populationSize` 到 100
2. 增加 `maxGenerations` 到 200
3. 调整 `mutationRate` 到 0.15
4. 确保时间段充足（课程数 < 容量 × 0.7）

### Q: 能否导出排课结果？

**A**: 当前版本结果直接显示在日历上，可以：
1. 截图保存
2. 手动导出事件数据
3. 未来版本将支持 Excel 导出

### Q: 如何处理特殊需求？

**A**: 可以在 `GeneticAlgorithm.js` 中：
1. 修改 `calculateFitness` 函数添加自定义约束
2. 调整评分权重
3. 添加新的冲突检测逻辑

---

## [工具]️ 技术架构

### 文件结构

```
Function/
├── Function.js              # 主组件
├── Function.css             # 样式文件
├── GeneticAlgorithm.js      # 遗传算法核心
└── AI排课使用说明.md        # 本文档
```

### 核心类方法

**GeneticAlgorithm 类**:

| 方法 | 功能 |
|------|------|
| `generateInitialPopulation()` | 生成初始种群 |
| `calculateFitness()` | 计算适应度 |
| `findConflicts()` | 查找冲突 |
| `selection()` | 选择操作 |
| `crossover()` | 交叉操作 |
| `mutate()` | 变异操作 |
| `evolve()` | 主进化循环 |
| `convertToCalendarEvents()` | 转换为日历格式 |

---

## [文档] 参考资料

### 遗传算法理论

- [遗传算法 - 维基百科](https://zh.wikipedia.org/wiki/%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95)
- [Genetic Algorithms Explained](https://towardsdatascience.com/introduction-to-genetic-algorithms-including-example-code-e396e98d8bf3)

### 相关项目

- [AlmanacAI - Time Table Generation](https://github.com/Harjotraith04/Time_Table_Generation_AI_Tool)
- [FullCalendar Documentation](https://fullcalendar.io/docs)

### 排课问题

- [课程表问题（Timetabling Problem）](https://en.wikipedia.org/wiki/Timetabling)
- [约束满足问题（CSP）](https://en.wikipedia.org/wiki/Constraint_satisfaction_problem)

---

## [未来] 未来计划

### v1.1（计划中）

- [ ] Excel 数据导入
- [ ] 排课结果导出
- [ ] 自定义约束规则
- [ ] 多目标优化

### v1.2（计划中）

- [ ] 手动调整优化
- [ ] 历史记录保存
- [ ] 对比多个方案
- [ ] 可视化进化过程

### v2.0（远期）

- [ ] 深度学习排课
- [ ] 实时冲突检测
- [ ] 协同排课
- [ ] 移动App

---

**版本**: v1.0.0  
**更新日期**: 2026-01-08  
**作者**: 前途塾技术团队  
**基于**: AlmanacAI Genetic Algorithm

