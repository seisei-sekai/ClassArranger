# 测试数据开关功能说明

## 功能概述

在 Layout 层添加了一个全局的"测试数据"开关，用于控制三个子页面（Dashboard、排课功能、我的主页）的测试数据显示。

---

## 使用方法

### 位置
- **侧边栏底部**：位于用户信息上方
- **图标**：方形十字图标，激活时中心有实心圆
- **标签**：
  - 关闭状态："测试数据: 关"
  - 开启状态："测试数据: 开"

### 操作
1. 点击按钮切换状态
2. 所有页面的测试数据同步显示/隐藏
3. 桌面端：显示文字标签
4. 移动端：仅显示图标（节省空间）

---

## 技术实现

### 架构

```
TestDataContext (Context API)
    ↓
XdfLayout (Provider)
    ├─→ Dashboard (Consumer)
    ├─→ Function (Consumer)
    └─→ MyPage (Consumer)
```

### 核心文件

#### 1. TestDataContext.js
```javascript
// 全局状态管理
const TestDataContext = createContext();

export const useTestData = () => {
  const context = useContext(TestDataContext);
  return context; // { showTestData, toggleTestData }
};

export const TestDataProvider = ({ children }) => {
  const [showTestData, setShowTestData] = useState(false); // 默认关闭
  // ...
};
```

**特点**：
- 使用 React Context API 实现全局状态
- 默认关闭（`false`），确保生产环境数据干净
- 提供自定义 Hook `useTestData()` 方便使用

#### 2. XdfLayout.js
```javascript
// Provider 包裹
<TestDataProvider>
  <XdfLayoutContent>{children}</XdfLayoutContent>
</TestDataProvider>

// Toggle 按钮
<button 
  className={`test-data-toggle ${showTestData ? 'active' : ''}`}
  onClick={toggleTestData}
>
  <svg>...</svg>
  {sidebarOpen && <span>{showTestData ? '测试数据: 开' : '测试数据: 关'}</span>}
</button>
```

**特点**：
- 在 Layout 层级提供 Provider
- 按钮有明显的激活状态（绿色背景）
- 支持侧边栏折叠/展开

#### 3. 子页面（Dashboard, Function, MyPage）
```javascript
import { useTestData } from '../TestDataContext';

const Dashboard = () => {
  const { showTestData } = useTestData();
  
  const statsCards = showTestData ? [...testData] : [];
  const recentClasses = showTestData ? [...testData] : [];
  
  // 渲染空状态或数据
  return (
    <>
      {data.length === 0 ? <EmptyState /> : <DataList />}
    </>
  );
};
```

**特点**：
- 使用 `useTestData()` Hook 获取状态
- 数据根据 `showTestData` 动态切换
- 空状态提示用户如何开启测试数据

---

## 各页面数据说明

### Dashboard
**测试数据**：
- 4个统计卡片（今日课程、本周排课、活跃学生、教室使用率）
- 4条今日课程记录
- 4个快速操作按钮（固定显示）

**空状态**：
- 图标：日历图标
- 文本："暂无课程数据"
- 提示："请点击左下角'测试数据'按钮查看示例"

### Function (排课功能)
**测试数据**：
- 3个示例课程（面试练习、志望理由书、EJU日语）
- ID前缀：`sample-`（用于识别）

**空状态**：
- 空白日历（默认状态）
- 不影响教程功能（教程数据ID前缀：`tutorial-`）

**特殊逻辑**：
```javascript
useEffect(() => {
  if (showTestData) {
    // 添加示例数据，保留教程和用户数据
    const current = events.filter(e => 
      !e.id.startsWith('sample-') && !e.id.startsWith('tutorial-')
    );
    setEvents([...current, ...sampleEvents]);
  } else {
    // 移除示例数据，保留教程和用户数据
    setEvents(events.filter(e => !e.id.startsWith('sample-')));
  }
}, [showTestData]);
```

### MyPage (我的主页)
**测试数据**：
- 用户信息卡片（姓名、邮箱、电话等）
- 4个统计数据（排课总数、活跃学生、合作教师、教室数量）
- 5条最近活动记录

**空状态**：
- 用户卡片：用户图标 + "暂无用户数据"
- 活动列表：时钟图标 + "暂无活动记录"

---

## UI设计

### 按钮样式

**默认状态（关闭）**：
```css
.test-data-toggle {
  background: #FFFFFF;
  border: 1px solid #E8E8E8;
  color: #718096;
}
```
- 白色背景
- 灰色边框
- 灰色文字

**激活状态（开启）**：
```css
.test-data-toggle.active {
  background: #E8F0E9;  /* 淡绿色背景 */
  border-color: #6B7C6E;  /* 绿色边框 */
  color: #6B7C6E;  /* 绿色文字 */
}
```
- 淡绿色背景
- 绿色边框和文字
- 明显的视觉反馈

**图标设计**：
```jsx
<svg width="18" height="18" viewBox="0 0 24 24" fill="none">
  <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" strokeWidth="2"/>
  <path d="M7 12h10M12 7v10" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
  {showTestData && (
    <circle cx="12" cy="12" r="3" fill="currentColor"/>
  )}
</svg>
```
- 方形框 + 十字（代表添加/数据）
- 激活时中心有实心圆（开关指示器）

### 空状态样式

```css
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  text-align: center;
}

.empty-text {
  font-size: 16px;
  font-weight: 500;
  color: #4A5568;
}

.empty-hint {
  font-size: 13px;
  color: #94A3B1;
}
```

**视觉效果**：
- 居中布局
- 图标半透明（opacity: 0.3）
- 灰色文字层次分明
- 友好的提示信息

---

## 响应式设计

### 桌面端（Sidebar 展开）
```
┌────────────────────┐
│ [+] 测试数据: 开   │ ← 完整标签
└────────────────────┘
```

### 桌面端（Sidebar 折叠）
```
┌────┐
│ [+]│ ← 仅图标
└────┘
```

### 移动端
- 侧边栏在抽屉中显示
- 按钮全宽显示
- 完整标签可见

---

## 数据管理策略

### 数据分类

| 分类 | ID前缀 | 是否受Toggle影响 | 说明 |
|------|--------|-----------------|------|
| 示例数据 | `sample-` | ✓ 是 | 测试数据开关控制 |
| 教程数据 | `tutorial-` | ✗ 否 | 独立教程开关控制 |
| 用户数据 | 任意 | ✗ 否 | 用户创建，永久保留 |
| AI生成数据 | `ai-` | ✗ 否 | AI排课生成，用户可删除 |

### 数据持久化

**当前状态**：
- 数据存储在组件 state 中
- 刷新页面后重置

**未来扩展**：
```javascript
// LocalStorage 持久化
useEffect(() => {
  const saved = localStorage.getItem('xdf_showTestData');
  if (saved !== null) {
    setShowTestData(JSON.parse(saved));
  }
}, []);

useEffect(() => {
  localStorage.setItem('xdf_showTestData', JSON.stringify(showTestData));
}, [showTestData]);
```

---

## 使用场景

### 开发阶段
1. 打开测试数据查看UI效果
2. 快速验证功能逻辑
3. 演示给产品经理/设计师

### 演示阶段
1. 向客户展示系统功能
2. 用示例数据讲解流程
3. 避免使用真实敏感数据

### 测试阶段
1. 测试空状态UI
2. 测试数据切换逻辑
3. 验证性能和边界情况

### 生产环境
1. 默认关闭测试数据
2. 用户从空白状态开始
3. 逐步添加真实数据

---

## 最佳实践

### 1. 数据命名规范
```javascript
// 推荐：使用前缀区分数据类型
const sampleEvents = [
  { id: 'sample-1', ... },
  { id: 'sample-2', ... },
];

const tutorialEvents = [
  { id: 'tutorial-1', ... },
  { id: 'tutorial-2', ... },
];
```

### 2. 空状态设计
```jsx
// 推荐：友好的空状态提示
<div className="empty-state">
  <svg>...</svg>
  <p className="empty-text">暂无数据</p>
  <p className="empty-hint">请点击左下角"测试数据"按钮查看示例</p>
</div>

// 不推荐：仅文字提示
<div>暂无数据</div>
```

### 3. 条件渲染
```javascript
// 推荐：三元运算符清晰
{data.length === 0 ? <EmptyState /> : <DataList data={data} />}

// 可接受：逻辑与
{data.length > 0 && <DataList data={data} />}
```

### 4. useEffect 依赖
```javascript
// 正确：添加 eslint-disable 注释
useEffect(() => {
  // ... 复杂逻辑
  // eslint-disable-next-line react-hooks/exhaustive-deps
}, [showTestData]);

// 或者：将依赖的函数移到 effect 内部
```

---

## 故障排查

### 问题1：切换后数据没有更新
**原因**：子组件没有正确使用 Context  
**解决**：
```javascript
// 确保导入和使用 Hook
import { useTestData } from '../TestDataContext';
const { showTestData } = useTestData();
```

### 问题2：页面刷新后状态重置
**原因**：没有持久化存储  
**解决**：使用 localStorage 或 后端API

### 问题3：教程数据被误删
**原因**：ID前缀冲突  
**解决**：严格遵守命名规范
```javascript
// 确保过滤逻辑正确
events.filter(e => !e.id.startsWith('sample-'))  // 保留教程和用户数据
```

### 问题4：Context 找不到
**错误**：`useTestData must be used within TestDataProvider`  
**原因**：组件不在 Provider 内部  
**解决**：确保 XdfLayout 包裹了 Provider

---

## 扩展功能建议

### v1.1 - 数据持久化
- LocalStorage 存储开关状态
- 记住用户偏好

### v1.2 - 多套测试数据
```javascript
const [testDataSet, setTestDataSet] = useState('default');
// 'default', 'large', 'edge-case'
```

### v1.3 - 数据导入/导出
```javascript
const exportTestData = () => {
  const data = JSON.stringify(events);
  // 下载 JSON 文件
};

const importTestData = (file) => {
  // 从文件读取并设置
};
```

### v2.0 - 权限控制
```javascript
const userRole = getCurrentUserRole();
const canToggleTestData = userRole === 'admin' || userRole === 'developer';
```

---

## 总结

**优点**：
- ✓ 全局统一管理
- ✓ 一键切换所有页面
- ✓ 友好的空状态提示
- ✓ 不影响用户数据
- ✓ 支持响应式设计

**限制**：
- 测试数据硬编码
- 刷新页面状态重置
- 无权限控制

**未来方向**：
- 数据持久化
- 多套测试数据
- 导入/导出功能
- 权限管理

---

**更新日期**: 2026年1月8日  
**版本**: v1.0  
**状态**: ✓ 已完成并测试

