# OpenAI API é…ç½®æŒ‡å—

**Created:** 2026-02-02
**Last Updated:** 2026-02-02
**Purpose:** å¦‚ä½•é…ç½®OpenAI APIä»¥å¯ç”¨AIæ™ºèƒ½è§£æåŠŸèƒ½

---

## æ¦‚è¿°

Experiment3çš„"AIæ™ºèƒ½è§£æ"åŠŸèƒ½ä½¿ç”¨OpenAI APIæ¥è§£æå­¦ç”Ÿçš„å¤æ‚çº¦æŸæ¡ä»¶ã€‚å¦‚æœä¸é…ç½®APIå¯†é’¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨Mockæ¨¡å¼ã€‚

---

## è·å–APIå¯†é’¥

### 1. è®¿é—®OpenAIå¹³å°

è®¿é—®ï¼šhttps://platform.openai.com/api-keys

### 2. ç™»å½•/æ³¨å†Œ

- å¦‚æœæ²¡æœ‰è´¦å·ï¼Œéœ€è¦å…ˆæ³¨å†Œ
- éœ€è¦ç»‘å®šæ”¯ä»˜æ–¹å¼ï¼ˆä¿¡ç”¨å¡ï¼‰

### 3. åˆ›å»ºAPIå¯†é’¥

1. ç‚¹å‡»"Create new secret key"
2. ç»™å¯†é’¥èµ·ä¸ªåå­—ï¼ˆå¦‚"XDF Class Arranger"ï¼‰
3. **ç«‹å³å¤åˆ¶å¯†é’¥**ï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼ï¼‰
4. å®‰å…¨ä¿å­˜å¯†é’¥

---

## é…ç½®æ–¹æ³•

### æ–¹æ³•1: æœ¬åœ°å¼€å‘ç¯å¢ƒ

#### æ­¥éª¤1: ç¼–è¾‘`.env`æ–‡ä»¶

```bash
cd /Users/benz/Desktop/Stanford/SP26/æ–°ä¸œæ–¹/XDF
nano .env  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

#### æ­¥éª¤2: æ·»åŠ APIå¯†é’¥

æ‰¾åˆ°è¿™ä¸€è¡Œï¼š
```env
OPENAI_API_KEY=
```

ä¿®æ”¹ä¸ºï¼š
```env
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxx
```

ï¼ˆæ›¿æ¢ä¸ºä½ çš„å®é™…APIå¯†é’¥ï¼‰

#### æ­¥éª¤3: é‡å¯åç«¯æœåŠ¡

```bash
# å¦‚æœä½¿ç”¨Docker Compose
docker-compose restart backend

# å¦‚æœç›´æ¥è¿è¡ŒPython
# åœæ­¢åç«¯ï¼ˆCtrl+Cï¼‰ï¼Œç„¶åé‡æ–°å¯åŠ¨
cd backend
uvicorn app.main:app --reload
```

---

### æ–¹æ³•2: Dockerç”Ÿäº§ç¯å¢ƒ

#### æ­¥éª¤1: ç¼–è¾‘`.env`æ–‡ä»¶

```bash
nano .env
```

æ·»åŠ ï¼š
```env
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxx
```

#### æ­¥éª¤2: é‡å¯æœåŠ¡

```bash
docker-compose down
docker-compose up -d
```

---

### æ–¹æ³•3: ç›´æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä¸´æ—¶ï¼‰

```bash
# Linux/Mac
export OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxx
uvicorn app.main:app --reload

# Windows (PowerShell)
$env:OPENAI_API_KEY="sk-proj-xxxxxxxxxxxxxxxxxxxx"
uvicorn app.main:app --reload
```

---

## éªŒè¯é…ç½®

### 1. æ£€æŸ¥åç«¯æ—¥å¿—

å¯åŠ¨åç«¯åï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š
```
âœ… OpenAI service initialized (using backend proxy)
```

### 2. è®¿é—®å¥åº·æ£€æŸ¥ç«¯ç‚¹

```bash
curl http://localhost:8000/ai/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "status": "healthy",
  "service": "mock-ai",
  "version": "1.0.0",
  "openai_configured": true  // âœ… è¿™é‡Œåº”è¯¥æ˜¯true
}
```

### 3. æµ‹è¯•AIè§£æåŠŸèƒ½

1. è®¿é—®Experiment3é¡µé¢
2. å¯¼å…¥å­¦ç”Ÿæ•°æ®
3. ç‚¹å‡»"çº¦æŸç®¡ç†"
4. ç‚¹å‡»"AIæ™ºèƒ½è§£æ"
5. å¦‚æœé…ç½®æ­£ç¡®ï¼Œåº”è¯¥èƒ½çœ‹åˆ°è§£æè¿›åº¦å’Œç»“æœ

---

## é”™è¯¯æ’æŸ¥

### é”™è¯¯1: 503 Service Unavailable

**é”™è¯¯ä¿¡æ¯**:
```
âŒ åç«¯OpenAI APIæœªé…ç½®ï¼
è¯·è”ç³»ç®¡ç†å‘˜åœ¨æœåŠ¡å™¨ç«¯é…ç½® OPENAI_API_KEY ç¯å¢ƒå˜é‡ã€‚
```

**åŸå› **: APIå¯†é’¥æœªé…ç½®æˆ–æœªç”Ÿæ•ˆ

**è§£å†³**:
1. ç¡®è®¤`.env`æ–‡ä»¶ä¸­æœ‰`OPENAI_API_KEY`
2. ç¡®è®¤å¯†é’¥æ ¼å¼æ­£ç¡®ï¼ˆä»¥`sk-`å¼€å¤´ï¼‰
3. é‡å¯åç«¯æœåŠ¡
4. æ£€æŸ¥åç«¯æ—¥å¿—

### é”™è¯¯2: 401 Unauthorized

**é”™è¯¯ä¿¡æ¯**:
```
OpenAI API call failed
401: Incorrect API key provided
```

**åŸå› **: APIå¯†é’¥æ— æ•ˆæˆ–è¿‡æœŸ

**è§£å†³**:
1. æ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡®å¤åˆ¶ï¼ˆæ²¡æœ‰å¤šä½™ç©ºæ ¼ï¼‰
2. ç™»å½•OpenAIå¹³å°æ£€æŸ¥å¯†é’¥çŠ¶æ€
3. å¦‚æœå¯†é’¥è¢«åˆ é™¤ï¼Œåˆ›å»ºæ–°å¯†é’¥

### é”™è¯¯3: 429 Rate Limit

**é”™è¯¯ä¿¡æ¯**:
```
OpenAI API call failed
429: Rate limit exceeded
```

**åŸå› **: è¶…è¿‡APIä½¿ç”¨é™é¢

**è§£å†³**:
1. ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•
2. æ£€æŸ¥OpenAIè´¦æˆ·ä½™é¢
3. å‡çº§APIè®¡åˆ’ï¼ˆå¦‚æœéœ€è¦ï¼‰

### é”™è¯¯4: 500 Internal Server Error

**é”™è¯¯ä¿¡æ¯**:
```
OpenAI API call failed
500: The server had an error processing your request
```

**åŸå› **: OpenAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨

**è§£å†³**:
1. ç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•
2. æ£€æŸ¥OpenAIçŠ¶æ€é¡µé¢ï¼šhttps://status.openai.com/
3. å¦‚æœæŒç»­å‡ºé”™ï¼Œä½¿ç”¨Mockæ¨¡å¼

---

## Mockæ¨¡å¼

å¦‚æœä¸æƒ³ä½¿ç”¨OpenAI APIï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨Mockæ¨¡å¼ï¼š

### Mockæ¨¡å¼ç‰¹ç‚¹

âœ… **ä¼˜ç‚¹**:
- æ— éœ€APIå¯†é’¥
- æ— è´¹ç”¨
- å“åº”é€Ÿåº¦å¿«
- é€‚åˆå¼€å‘æµ‹è¯•

âŒ **é™åˆ¶**:
- è§£æç»“æœæ˜¯é¢„è®¾çš„ç¤ºä¾‹
- ä¸èƒ½å¤„ç†å¤æ‚çº¦æŸ
- ä»…ç”¨äºæ¼”ç¤ºå’Œæµ‹è¯•

### å¯ç”¨Mockæ¨¡å¼

ä¿æŒ`.env`æ–‡ä»¶ä¸­çš„`OPENAI_API_KEY`ä¸ºç©ºï¼š
```env
OPENAI_API_KEY=
```

å‰ç«¯ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æ˜¾ç¤ºï¼š
```
ğŸ¤– ä½¿ç”¨Mockæ¨¡å¼ï¼ˆæ¼”ç¤ºï¼‰
```

---

## è´¹ç”¨ä¼°ç®—

### OpenAIå®šä»·ï¼ˆ2026-02ï¼‰

**gpt-4o-miniæ¨¡å‹**ï¼ˆç³»ç»Ÿé»˜è®¤ä½¿ç”¨ï¼‰:
- è¾“å…¥ï¼š$0.15 / 1M tokens
- è¾“å‡ºï¼š$0.60 / 1M tokens

### å…¸å‹ä½¿ç”¨åœºæ™¯

**è§£æä¸€ä¸ªå­¦ç”Ÿçš„çº¦æŸ**:
- è¾“å…¥ï¼š~500 tokens
- è¾“å‡ºï¼š~200 tokens
- è´¹ç”¨ï¼šçº¦$0.0002ï¼ˆ0.02åˆ†äººæ°‘å¸ï¼‰

**è§£æ100ä¸ªå­¦ç”Ÿ**:
- æ€»è´¹ç”¨ï¼šçº¦$0.02ï¼ˆ2åˆ†äººæ°‘å¸ï¼‰

### æˆæœ¬æ§åˆ¶

1. **æ‰¹é‡å¤„ç†**: ä¸€æ¬¡è§£æå¤šä¸ªå­¦ç”Ÿï¼Œé™ä½APIè°ƒç”¨æ¬¡æ•°
2. **ç¼“å­˜ç»“æœ**: è§£æåä¿å­˜ç»“æœï¼Œé¿å…é‡å¤è§£æ
3. **ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹**: å¦‚`gpt-3.5-turbo`ï¼ˆä½†å‡†ç¡®åº¦å¯èƒ½ä¸‹é™ï¼‰

---

## å®‰å…¨å»ºè®®

### DO âœ…

1. **ä½¿ç”¨ç¯å¢ƒå˜é‡**: æ°¸è¿œä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç APIå¯†é’¥
2. **é™åˆ¶æƒé™**: åªç»™APIå¯†é’¥å¿…è¦çš„æƒé™
3. **å®šæœŸè½®æ¢**: å®šæœŸæ›´æ¢APIå¯†é’¥
4. **ç›‘æ§ä½¿ç”¨**: å®šæœŸæ£€æŸ¥APIä½¿ç”¨é‡å’Œè´¹ç”¨
5. **è®¾ç½®é¢„ç®—**: åœ¨OpenAIå¹³å°è®¾ç½®æœˆåº¦é¢„ç®—é™åˆ¶

### DON'T âŒ

1. **ä¸è¦æäº¤åˆ°Git**: `.env`æ–‡ä»¶åº”åœ¨`.gitignore`ä¸­
2. **ä¸è¦å…±äº«**: ä¸è¦åœ¨èŠå¤©ã€é‚®ä»¶ä¸­å‘é€APIå¯†é’¥
3. **ä¸è¦æš´éœ²**: ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­æš´éœ²å¯†é’¥
4. **ä¸è¦ä½¿ç”¨æ˜æ–‡**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡
5. **ä¸è¦å¿½è§†å‘Šè­¦**: å¦‚æœæ”¶åˆ°å¼‚å¸¸ä½¿ç”¨å‘Šè­¦ï¼Œç«‹å³æ£€æŸ¥

---

## é…ç½®æ–‡ä»¶ä½ç½®

### å¼€å‘ç¯å¢ƒ
```
/Users/benz/Desktop/Stanford/SP26/æ–°ä¸œæ–¹/XDF/.env
```

### Dockerç¯å¢ƒ
```
/Users/benz/Desktop/Stanford/SP26/æ–°ä¸œæ–¹/XDF/.env
ï¼ˆdocker-compose.ymlä¼šè¯»å–è¿™ä¸ªæ–‡ä»¶ï¼‰
```

### åç«¯é…ç½®
```
backend/app/core/config.py  ï¼ˆå®šä¹‰é…ç½®é¡¹ï¼‰
backend/app/api/routes/ai.py  ï¼ˆä½¿ç”¨APIå¯†é’¥ï¼‰
```

---

## å¸¸è§é—®é¢˜

### Q1: æ˜¯å¦å¿…é¡»é…ç½®OpenAI APIï¼Ÿ

**A**: ä¸æ˜¯å¿…é¡»çš„ã€‚å¦‚æœä¸é…ç½®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨Mockæ¨¡å¼ï¼Œä½†AIè§£æåŠŸèƒ½åªèƒ½è¿”å›ç¤ºä¾‹ç»“æœã€‚

### Q2: å¯ä»¥ä½¿ç”¨å…¶ä»–AIæœåŠ¡å—ï¼Ÿ

**A**: ç›®å‰åªæ”¯æŒOpenAIã€‚å¦‚éœ€æ”¯æŒå…¶ä»–æœåŠ¡ï¼ˆå¦‚Claudeã€æœ¬åœ°LLMç­‰ï¼‰ï¼Œéœ€è¦ä¿®æ”¹åç«¯ä»£ç ã€‚

### Q3: APIå¯†é’¥ä¼šè¿‡æœŸå—ï¼Ÿ

**A**: OpenAI APIå¯†é’¥ä¸ä¼šè‡ªåŠ¨è¿‡æœŸï¼Œä½†å¯ä»¥åœ¨å¹³å°ä¸Šæ‰‹åŠ¨æ’¤é”€ã€‚å»ºè®®å®šæœŸè½®æ¢å¯†é’¥ã€‚

### Q4: å¦‚ä½•é™åˆ¶APIä½¿ç”¨è´¹ç”¨ï¼Ÿ

**A**: åœ¨OpenAIå¹³å°çš„"Usage limits"ä¸­è®¾ç½®æœˆåº¦é¢„ç®—ä¸Šé™ã€‚

### Q5: å¯ä»¥ä½¿ç”¨å…è´¹é¢åº¦å—ï¼Ÿ

**A**: OpenAIæ–°ç”¨æˆ·æœ‰å…è´¹é¢åº¦ï¼ˆé€šå¸¸$5ï¼‰ï¼Œç”¨å®Œåéœ€è¦å……å€¼ã€‚

---

## æŠ€æœ¯ç»†èŠ‚

### APIè°ƒç”¨æµç¨‹

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant O as OpenAI API
    
    F->>F: ç”¨æˆ·ç‚¹å‡»"AIæ™ºèƒ½è§£æ"
    F->>B: POST /ai/openai/parse-constraint
    B->>B: æ£€æŸ¥OPENAI_API_KEY
    alt APIå¯†é’¥å·²é…ç½®
        B->>O: chat.completions.create()
        O->>B: è¿”å›è§£æç»“æœ
        B->>F: è¿”å›JSONç»“æœ
        F->>F: æ˜¾ç¤ºè§£æç»“æœ
    else APIå¯†é’¥æœªé…ç½®
        B->>F: 503 Service Unavailable
        F->>F: é™çº§åˆ°Mockæ¨¡å¼
    end
```

### è¯·æ±‚æ ¼å¼

```python
{
    "system_prompt": "ä½ æ˜¯ä¸€ä¸ªæ’è¯¾çº¦æŸè§£æåŠ©æ‰‹...",
    "user_prompt": "å­¦ç”Ÿä¿¡æ¯ï¼š...",
    "model": "gpt-4o-mini",
    "temperature": 0
}
```

### å“åº”æ ¼å¼

```json
{
    "content": "{\"parsedConstraints\": [...]}",
    "model": "gpt-4o-mini-2024-07-18",
    "usage": {
        "prompt_tokens": 523,
        "completion_tokens": 187,
        "total_tokens": 710
    }
}
```

---

## å‚è€ƒé“¾æ¥

- **OpenAIå¹³å°**: https://platform.openai.com/
- **APIæ–‡æ¡£**: https://platform.openai.com/docs/api-reference
- **å®šä»·ä¿¡æ¯**: https://openai.com/api/pricing/
- **çŠ¶æ€é¡µé¢**: https://status.openai.com/
- **ä½¿ç”¨æŒ‡å—**: https://platform.openai.com/docs/guides/text-generation

---

**é…ç½®å®Œæˆåï¼Œè®°å¾—é‡å¯åç«¯æœåŠ¡ï¼**

```bash
# Dockeræ–¹å¼
docker-compose restart backend

# ç›´æ¥è¿è¡Œæ–¹å¼
# Ctrl+Cåœæ­¢ï¼Œç„¶åé‡æ–°è¿è¡Œ
cd backend
uvicorn app.main:app --reload
```
