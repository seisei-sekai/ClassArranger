# 一键排课按钮灰色问题诊断

**Created:** 2026-01-23  
**Last Updated:** 2026-01-23  
**Purpose:** 诊断和解决一键排课按钮显示为灰色不可点击的问题

---

## 🔍 问题现象

悬浮的"一键排课"按钮显示为灰色圆形，无法点击。

## 📋 按钮状态说明

### 灰色圆形（禁用）
**原因**：没有任何学生有有效课时

### 灰色椭圆（待选择）
**原因**：有学生但没有选中

### 紫色椭圆+角标（可点击）
**原因**：已选中至少1名有课时的学生

## 🔧 诊断步骤

### 步骤1：检查学生是否有课时徽章

1. 查看学生卡片右下角
2. 如果看到 `剩余: X/Y课时` → 学生有课时 ✅
3. 如果没有看到课时徽章 → **问题在这里** ❌

### 步骤2：检查Excel数据列

如果学生没有课时徽章，检查您的Excel数据：

#### 必需的列（从左往右数）：

| 列号 | 列名 | 说明 | 示例 |
|------|------|------|------|
| 列1 | 校区 | 学生所在校区 | `旗舰校` |
| 列2 | 学管姓名 | 班主任 | `张老师` |
| 列3 | 学生姓名 | 学生名字 | `小明` |
| 列4 | 学生批次 | 批次信息 | `2024春季` |
| 列5 | 录入日期 | 录入日期 | `2024-01-15` |
| **列6** | **上课频次** | **每周上课次数** | **`2次`、`多次`** |
| **列7** | **上课时长** | **每次上课时长** | **`2小时`、`90分钟`** |

⚠️ **关键**：列6和列7必须有值，且格式正确！

### 步骤3：检查数据格式

#### 上课频次（列6）支持的格式：

✅ **正确格式：**
- `2次`
- `3次`
- `多次`（会被识别为4次）
- `每周2`
- `每周3次`
- `2`（纯数字）

❌ **错误格式：**
- 空白
- `看情况`（无法识别）
- `不固定`（无法识别）
- 其他文字描述

#### 上课时长（列7）支持的格式：

✅ **正确格式：**
- `2小时`
- `1.5小时`
- `2h`
- `90分钟`
- `90min`
- `2`（纯数字，视为小时）

❌ **错误格式：**
- 空白
- `待定`（无法识别）
- `1-2小时`（无法识别）
- 其他文字描述

## 🛠️ 解决方案

### 方案1：修复Excel数据（推荐）

1. **打开Excel文件**
2. **找到列6（上课频次）和列7（上课时长）**
3. **填写正确格式的数据**
   ```
   列6：2次
   列7：2小时
   ```
4. **复制整行数据**
5. **重新导入到系统**

### 方案2：使用标准格式示例

复制以下示例数据测试：

```
旗舰校	张老师	测试学生	2024春季	2024-01-15	2次	2小时	线上	数学	中级	10	清华大学	计算机科学	2024-01-01 至 2024-06-30	周一下午	14:00-15:00	2	代数和几何	无
```

### 方案3：查看控制台调试信息

1. **打开浏览器控制台**（F12或右键→检查）
2. **切换到Console标签**
3. **重新保存学生数据**
4. **查找 `[排课系统] 学生课时信息:` 的日志**
5. **检查输出的信息**：
   ```javascript
   {
     name: "学生姓名",
     frequency: "2次",      // 应该有值
     duration: "2小时",     // 应该有值
     courseHours: {
       weeklyHours: 4,      // 应该 > 0
       totalHours: 48,      // 应该 > 0
       remainingHours: 48   // 应该 > 0
     }
   }
   ```

## ✅ 验证成功

如果修复成功，您会看到：

1. ✅ 学生卡片右下角显示课时徽章：`剩余: 48/48课时`
2. ✅ 学生卡片左侧出现复选框
3. ✅ 学生面板顶部显示："全选学生"按钮和"已选: 0 / 1"
4. ✅ 勾选学生后，悬浮按钮变为紫色椭圆，右上角显示数字角标

## 🎯 快速测试

### 测试数据（保证可用）

```
旗舰校	测试	测试学生A	2024春	2024-01-15	多次	1.5小时	线上	数学	中级	0	清华	计算机	春季	周一下午	14:00	4	代数	测试
```

**这条数据的课时计算：**
- 频次：`多次` → 4次/周
- 时长：`1.5小时` → 1.5小时/次
- 每周课时：4 × 1.5 = 6小时
- 总课时：6 × 12周 = 72小时

## 🔄 仍然无法解决？

### 终极诊断方法：

1. **删除所有现有学生**
2. **使用上面的测试数据创建一个新学生**
3. **查看是否出现课时徽章**
4. **如果出现**：说明原数据格式有问题
5. **如果不出现**：在控制台查看错误信息，联系技术支持

## 📞 常见问题

### Q: 我的Excel有这些列，但还是灰色？

**A**: 检查以下几点：
1. 列6和列7是否**真的有数据**（不是公式，是实际的文本）
2. 复制时是否包含了**所有19列**
3. 数据中是否有**多余的空格或特殊字符**

### Q: 可以临时跳过课时检查吗？

**A**: 不建议，因为排课系统需要课时信息来：
- 计算每周排课次数
- 控制排课总量
- 自动停止当课时用尽

### Q: "多次"被识别为4次合理吗？

**A**: 这是默认值，可以在数据中明确指定，如`4次`、`5次`等。

### Q: 我的数据格式特殊，怎么办？

**A**: 建议将数据规范化为支持的格式，或联系开发人员添加新的格式支持。

---

## 🎓 相关文档

- [课时计算和一键排课使用指南](./课时计算和一键排课使用指南.md) - 完整功能说明
- [AI智能解析使用流程](./AI智能解析使用流程.md) - 如何使用AI解析时间约束

---

**如果按照本指南操作后问题仍未解决，请提供控制台的日志截图以便进一步诊断。**

